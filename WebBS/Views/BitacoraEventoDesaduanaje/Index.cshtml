@using WebBS.Implement
@model WebBS.Models.IMP_DESADUANAJE

@{
    ViewBag.Title = "Index";
    var imp_adquisicion = @Model.IMP_SOLICITUD_IMPORTACION.IMP_ORDEN_COMPRA.IMP_SOLICITUD_IMPORTACION.FirstOrDefault(s => s.IMP_ADQUISICION.Count > 0).IMP_ADQUISICION.FirstOrDefault();
}

<h2>Bitacora de Eventos de Desaduanaje</h2>

<div id="divMensajeInformativo">
    <span class="fa fa-info-circle"></span>
    <span id="lblMensajeInformativo">Usted puede registrar los eventos de desaduanaje.</span>
</div>
<hr />

<div>
    <table class="table-bordered">
        <tr class="rowGroup" data-toggle="collapse" data-target="#Panel_@Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Numero">
            <td colspan="8">
                <h4>Solicitud #: @Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Numero</h4>
                <h5>Fecha : @Html.Raw(Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Fec_emision.Value.ToString("dd/MM/yyyy"))</h5>
                <h5>Estado: @Html.Raw(TablaDefinicion.ObtenerValor(Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Estado, TablaDefinicion.EstadoSolicitud))</h5>
                <p>@Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Descripcion</p>
                @if (Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Estado == WebBS.Implement.DatosConstantes.EstadoSolicitud.Rechazado)
                {
                    <h4>Motivo del rechazo:</h4>
                    <p>@Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Observaciones</p>
                }
            </td>
        </tr>
    </table>

    <hr />
    <h4 class="hasCollapse"> <a data-toggle="collapse" href="#accordion">Detalle de Solicitud</a></h4>

    <div class="panel-group collapse" id="accordion">
        <br />
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse1">
                        Orden de Compra
                    </a>
                </h4>
            </div>
            <div id="collapse1" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-1"></div>
                        <div class="col-sm-2">
                            Número
                        </div>

                        <div class="col-sm-3">
                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_ORDEN_COMPRA.Num_orden_compra
                        </div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-2">
                            Proveedor
                        </div>

                        <div class="col-sm-3">
                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_ORDEN_COMPRA.IMP_PROVEEDOR.Razon_social
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-sm-1"></div>
                        <div class="col-sm-2">
                            Fecha
                        </div>

                        <div class="col-sm-3">
                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_ORDEN_COMPRA.Fec_orden_compra
                        </div>
                        <div class="col-sm-1"></div>
                        <div class="col-sm-2">
                            Origen
                        </div>

                        <div class="col-sm-3">
                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_ORDEN_COMPRA.IMP_PROVEEDOR.Ruc
                        </div>
                    </div>
                    <hr />
                    <div class="row">
                        <div class="col-sm-6">
                            <h4>Productos</h4>
                        </div>
                    </div>
                    <table class="table-bordered">
                        <tr>
                            <th>
                                Item
                            </th>
                            <th>
                                Producto
                            </th>
                            <th>
                                Presentación
                            </th>
                            <th>Unidad de medida</th>
                            <th>Cantidad</th>
                        </tr>
                        @{
                            var itemNumero = 1;
                        }
                        @foreach (var item in Model.IMP_SOLICITUD_IMPORTACION.IMP_ORDEN_COMPRA.IMP_DETALLE_ORDEN_COMPRA)
                        {
                            <tr>
                                <td>
                                    @Html.Raw(itemNumero++)
                                </td>
                                <td>
                                    @Html.Raw(item.DIS_Producto.Nom_producto)
                                </td>
                                <td>
                                    @if (item.DIS_Producto.DIS_PresentacionProducto != null)
                                    {
                                        @Html.Raw(item.DIS_Producto.DIS_PresentacionProducto.Des_presentacion_producto)
                                    }
                                </td>
                                <td>@Html.Raw(item.DIS_Producto.Unidad_medida)</td>
                                <td>
                                    @Html.Raw(item.Cantidad)
                                </td>
                            </tr>
                        }

                    </table>
                </div>
            </div>
        </div>
        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">
                        Agentes Asignados
                    </a>
                </h4>
            </div>
            <div id="collapse2" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="row">
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Agentes Carga
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <label class="col-md-3">Agente  :</label>
                                        <div class="col-md-5">
                                            @imp_adquisicion.IMP_SOLICITUD_IMPORTACION.IMP_PROVEEDOR.Razon_social
                                        </div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-3">RUC :</label>
                                        <div class="col-md-2">
                                            @imp_adquisicion.IMP_SOLICITUD_IMPORTACION.IMP_PROVEEDOR.Ruc
                                        </div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-3">Telefono :</label>
                                        <div class="col-md-2">
                                            @imp_adquisicion.IMP_SOLICITUD_IMPORTACION.IMP_PROVEEDOR.Telefono
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-sm-6">
                            <div class="panel panel-default">
                                <div class="panel-heading">
                                    Agentes Aduanas
                                </div>
                                <div class="panel-body">
                                    <div class="row">
                                        <label class="col-md-3">Agente  :</label>
                                        <div class="col-md-5">
                                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_PROVEEDOR.Razon_social
                                        </div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-3">RUC :</label>
                                        <div class="col-md-2">
                                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_PROVEEDOR.Ruc
                                        </div>
                                    </div>

                                    <div class="row">
                                        <label class="col-md-3">Telefono :</label>
                                        <div class="col-md-2">
                                            @Model.IMP_SOLICITUD_IMPORTACION.IMP_PROVEEDOR.Telefono
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel panel-primary">
            <div class="panel-heading">
                <h4 class="panel-title">
                    <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">
                        Datos de la Adquisición
                    </a>
                </h4>
            </div>
            <div id="collapse3" class="panel-collapse collapse">
                <div class="panel-body">
                    <div class="row">
                        <div class="form-horizontal">
                            <div class="form-group">
                                <label class="control-label col-md-2" for="Fec_accion">Fecha de Embarque :</label>
                                <div class="col-md-2">
                                    @imp_adquisicion.Fec_Embarque.Value.ToString("dd/MM/yyyy")
                                </div>
                                <label class="control-label col-md-2" for="Fec_accion">Fecha de llegada :</label>
                                <div class="col-md-2">
                                    @imp_adquisicion.Fec_programada_llegada.Value.ToString("dd/MM/yyyy")
                                </div>
                            </div>
                            <div class="form-group">
                                <label class="control-label col-md-2" for="Fec_accion">Puerto de llegada :</label>
                                <div class="col-md-3">
                                    @imp_adquisicion.IMP_PUERTO.Nombre
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-2" for="Fec_accion">Factura Comercial :</label>
                                <div class="col-md-3">
                                    <a href="@Url.Content(imp_adquisicion.IMP_FACTURA_COMERCIAL.FirstOrDefault().Archivo)" class="control-table text-center" target="_blank"><i class="fa fa-file-archive-o"></i></a>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="control-label col-md-2" for="Fec_accion">Bill of lading :</label>
                                <div class="col-md-3">
                                    <a href="@Url.Content(imp_adquisicion.IMP_BL.FirstOrDefault().Archivo)" class="control-table text-center" target="_blank"><i class="fa fa-file-archive-o"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <hr />
    <div class="row">
        <div class="col-sm-6">
            <h4>Bitácora de Eventos</h4>
        </div>
        <div class="col-sm-6 text-right">
            <div class="form-group">
                @if (Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Estado == WebBS.Implement.DatosConstantes.EstadoSolicitud.Proceso)
            {
                    @Html.ActionLink("Añadir", "Create", new { id = Model.Cod_desaduanaje }, new { @class = "btn btn-primary" })
                }
            </div>
        </div>
    </div>

    @{
        int itemNumber = 1;
    }
    <table class="table-bordered">
        <tr>
            <th>
                Item
            </th>
            <th>
                Evento
            </th>
            <th>
                Fecha del evento
            </th>
            <th>
                Título
            </th>
            <th>
                Observaciones
            </th>
            @if (Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Estado == WebBS.Implement.DatosConstantes.EstadoSolicitud.Proceso)
            {
                <th></th>
            }
        </tr>

        @foreach (var item in Model.IMP_BITACORA_EVENTO.Where(a => !a.IMP_EVENTO.IMP_TIPO_EVENTO.EsAutomatico.Value))
        {
            <tr>
                <td>
                    @(itemNumber++)
                </td>
                <td>
                    @Html.Raw(item.IMP_EVENTO.IMP_TIPO_EVENTO.Nombre + " - " + item.IMP_EVENTO.Nombre)
                </td>
                <td>
                    @Html.Raw(item.Fec_evento.ToString("dd/MM/yyyy"))
                </td>
                <td>
                    @Html.DisplayFor(modelItem => item.Descripcion)
                </td>

                <td>
                    @Html.DisplayFor(modelItem => item.Observaciones)
                </td>
                @if (Model.IMP_SOLICITUD_IMPORTACION.IMP_SOLICITUD.Estado == WebBS.Implement.DatosConstantes.EstadoSolicitud.Proceso)
                {
                    <td>
                        <a class="control-table text-center" href="@Url.Action("Edit", "BitacoraEventoDesaduanaje",new  { Id=item.Cod_bitacora_evento })">

                            <i class="fa fa-edit"></i>
                        </a>
                        <a class="control-table text-center" href="@Url.Action("Details", "BitacoraEventoDesaduanaje",new  { Id=item.Cod_bitacora_evento })">

                            <i class="fa fa-eye"></i>
                        </a>
                        <a class="control-table text-center" href="@Url.Action("Delete", "BitacoraEventoDesaduanaje",new  { Id=item.Cod_bitacora_evento })">

                            <i class="fa fa-trash-o"></i>
                        </a>
                    </td>
                }

            </tr>
        }

    </table>

    <div class="row">
        <div class="col-sm-12 text-right">
            <a id="btnCancelar" class="btn btn-default" href="@Url.Action("Index", "SolicitudAdquisicion")">Salir</a>
        </div>
    </div>

</div>
